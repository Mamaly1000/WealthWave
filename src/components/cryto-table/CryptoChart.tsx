import React, { useRef, useEffect, useState } from "react";
import type { ChartData, ChartArea } from "chart.js";
import {
  Chart as ChartJS,
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Tooltip,
  Legend,
} from "chart.js";
import { Chart, Line, Bar } from "react-chartjs-2";
import faker from "faker";

ChartJS.register(
  CategoryScale,
  LinearScale,
  PointElement,
  LineElement,
  Tooltip,
  Legend
);

const labels = ["January", "February", "March", "April", "May", "June", "July"];
const colors = [
  "red",
  "orange",
  "yellow",
  "lime",
  "green",
  "teal",
  "blue",
  "purple",
];

export const data = {
  labels,
  datasets: [
    {
      label: "Dataset 1",
      data: labels.map(() => faker.datatype.number({ min: -1000, max: 1000 })),
    },
    {
      label: "Dataset 2",
      data: labels.map(() => faker.datatype.number({ min: -1000, max: 1000 })),
    },
  ],
};

function createGradient(ctx: CanvasRenderingContext2D, area: ChartArea) {
  const colorStart = faker.random.arrayElement(colors);
  const colorMid = faker.random.arrayElement(
    colors.filter((color) => color !== colorStart)
  );
  const colorEnd = faker.random.arrayElement(
    colors.filter((color) => color !== colorStart && color !== colorMid)
  );

  const gradient = ctx.createLinearGradient(0, area.bottom, 0, area.top);

  gradient.addColorStop(0, colorStart);
  gradient.addColorStop(0.5, colorMid);
  gradient.addColorStop(1, colorEnd);

  return gradient;
}

const btc_chart_data = [
  [1687428028695, 30112.18883],
  [1687431634840, 30219.63385],
  [1687435230794, 29923.34779],
  [1687438826743, 30108.4053],
  [1687442441557, 30262.74305],
  [1687446061412, 29923.31407],
  [1687449622767, 29779.36327],
  [1687453215146, 29952.78202],
  [1687456867454, 30150.27536],
  [1687460421247, 30067.81352],
  [1687464051446, 30167.25429],
  [1687467636169, 30160.68471],
  [1687471211370, 30032.03072],
  [1687474821714, 29990.43868],
  [1687478437431, 29935.63211],
  [1687482042290, 30024.17749],
  [1687485623487, 30008.83952],
  [1687489215931, 29970.40646],
  [1687492825231, 30017.26991],
  [1687496466006, 30000.3513],
  [1687500019023, 30045.89113],
  [1687503636731, 30006.99173],
  [1687507239008, 29960.13524],
  [1687510817507, 30026.8428],
  [1687514429377, 30004.51721],
  [1687518016905, 30103.28804],
  [1687521647049, 30095.93484],
  [1687525239441, 30119.99756],
  [1687528839460, 30012.92341],
  [1687532433117, 30268.52696],
  [1687536031856, 30982.75257],
  [1687539641624, 30977.25127],
  [1687543207977, 31185.21983],
  [1687546827068, 30930.14672],
  [1687550403514, 30813.13994],
  [1687554047367, 30909.18288],
  [1687557652079, 30716.10018],
  [1687561217346, 30651.26712],
  [1687564819509, 30629.24435],
  [1687568403088, 30497.81442],
  [1687572028748, 30580.31872],
  [1687575664427, 30779.2562],
  [1687579235128, 30747.41027],
  [1687582838099, 30724.74556],
  [1687586429944, 30720.38117],
  [1687590027334, 30724.50097],
  [1687593617789, 30635.39927],
  [1687597217286, 30593.71308],
  [1687600814965, 30628.59442],
  [1687604433314, 30744.29523],
  [1687608038212, 30702.20649],
  [1687611670147, 30700.69875],
  [1687615229360, 30644.0961],
  [1687618808834, 30688.68298],
  [1687622428198, 30403.97737],
  [1687626032592, 30489.82764],
  [1687629605261, 30619.45495],
  [1687633245752, 30664.56321],
  [1687636840876, 30647.40468],
  [1687640420215, 30564.88647],
  [1687644031439, 30529.59424],
  [1687647600926, 30523.24113],
  [1687651219387, 30537.81666],
  [1687654839440, 30529.95416],
  [1687658423729, 30626.81855],
  [1687662006228, 30658.4197],
  [1687665618123, 30787.55658],
  [1687669212331, 30943.91],
  [1687672824554, 30868.72228],
  [1687676423411, 30847.34296],
  [1687680042440, 30723.98797],
  [1687683618488, 30749.26959],
  [1687687209569, 30714.11915],
  // [1687690808192, 30613.85633],
  // [1687694400466, 30652.59456],
  // [1687698020645, 30661.39392],
  // [1687701610211, 30659.65106],
  // [1687705211384, 30582.64733],
  // [1687708863627, 30560.92698],
  // [1687712404953, 30586.29821],
  // [1687716001857, 30577.77562],
  // [1687719639182, 30422.34889],
  // [1687723253286, 30402.60499],
  // [1687726818692, 30494.43491],
  // [1687730438743, 30452.38233],
  // [1687734026277, 30517.73067],
  // [1687737630293, 30469.35912],
  // [1687741224850, 30508.60889],
  // [1687744813711, 30241.28442],
  // [1687748429294, 30193.63862],
  // [1687752021902, 30236.23362],
  // [1687755616008, 30250.63805],
  // [1687759230749, 30236.42468],
  // [1687762826474, 30430.88476],
  // [1687766454258, 30401.99055],
  // [1687770002708, 30394.06847],
  // [1687773654173, 30303.89009],
  // [1687777232652, 30262.62254],
  // [1687780840556, 30323.56665],
  // [1687784433348, 30305.29806],
  // [1687788018053, 30448.97576],
  // [1687791628389, 30393.01984],
  // [1687795212684, 30443.0527],
  // [1687798832718, 30196.35531],
  // [1687802466026, 30108.57294],
  // [1687806021484, 30211.89895],
  // [1687809617100, 30259.42775],
  // [1687813243987, 30170.70048],
  // [1687816822159, 30160.11414],
  // [1687820413335, 30238.17075],
  // [1687824023105, 30285.50506],
  // [1687827619438, 30359.0487],
  // [1687831237072, 30356.51563],
  // [1687834849136, 30427.44817],
  // [1687838429780, 30403.98989],
  // [1687842031256, 30351.99484],
  // [1687845618569, 30311.29936],
  // [1687849226337, 30276.39402],
  // [1687852892229, 30412.25304],
  // [1687856407430, 30375.47437],
  // [1687860027382, 30379.31873],
  // [1687863619891, 30643.96054],
  // [1687867236618, 30709.36531],
  // [1687870839594, 30708.68778],
  // [1687874450351, 30622.53675],
  // [1687878039387, 30796.12564],
  // [1687881655218, 30606.5486],
  // [1687885243426, 30680.77714],
  // [1687888814295, 30714.67956],
  // [1687892448054, 30717.96616],
  // [1687896039879, 30707.86528],
  // [1687899638269, 30644.64832],
  // [1687903220879, 30762.42736],
  // [1687906831554, 30601.38917],
  // [1687910446176, 30693.54636],
  // [1687914050720, 30601.86452],
  // [1687917628174, 30514.81756],
  // [1687921210165, 30513.49337],
  // [1687924858607, 30468.14854],
  // [1687928428487, 30457.38622],
  // [1687932016323, 30455.03729],
  // [1687935640843, 30429.00156],
  // [1687939249679, 30180.93022],
  // [1687942818632, 30270.93176],
  // [1687946444723, 30297.07733],
  // [1687950037340, 30334.2345],
  // [1687953609985, 30365.94645],
  // [1687957279362, 30098.4932],
  // [1687960828757, 30181.454],
  // [1687964446315, 30415.63964],
  // [1687968016219, 30390.91541],
  // [1687971641243, 30333.12967],
  // [1687975223396, 30129.35151],
  // [1687978840846, 30197.22296],
  // [1687982414888, 30073.87015],
  // [1687986034900, 30105.93008],
  // [1687989631677, 30131.34826],
  // [1687993226837, 30095.79941],
  // [1687996882370, 30083.47725],
  // [1688000413536, 30065.74841],
  // [1688004059151, 30154.67107],
  // [1688007649621, 30108.13936],
  // [1688011232175, 30166.21956],
  // [1688014842157, 30218.08715],
  // [1688018417984, 30209.92305],
  // [1688022031118, 30236.24293],
  // [1688025608838, 30347.20498],
  // [1688029238530, 30384.50283],
  // [1688032843589, 30433.36706],
  // [1688036459428, 30695.66441],
  // [1688040047791, 30648.69491],
  // [1688043636157, 30637.41352],
  // [1688047237686, 30707.59945],
  // [1688050841685, 30481.6378],
  // [1688054442068, 30472.28485],
  // [1688058036547, 30524.03893],
  // [1688061660551, 30540.37239],
  // [1688065268932, 30586.30841],
  // [1688068816054, 30586.87086],
  // [1688072470795, 30356.84978],
  // [1688076037587, 30438.8075],
  // [1688079627952, 30437.61341],
  // [1688083210079, 30466.61046],
  // [1688086829764, 30459.16529],
  // [1688090443244, 30395.76573],
  // [1688094033469, 30663.75791],
  // [1688097637586, 30708.5298],
  // [1688101225959, 31157.35074],
  // [1688104842470, 30730.82955],
  // [1688108419783, 30662.94365],
  // [1688112033831, 30739.90712],
  // [1688115627962, 30828.28422],
  // [1688119240978, 30743.82106],
  // [1688122844315, 30792.15314],
  // [1688126458017, 30866.86734],
  // [1688130043672, 31053.37638],
  // [1688133681784, 29894.7783],
  // [1688137211696, 30143.60513],
  // [1688140802075, 30036.76251],
  // [1688144463215, 30383.43527],
  // [1688148038911, 30538.55583],
  // [1688151666882, 30316.47472],
  // [1688155242480, 30423.07329],
  // [1688158826825, 30419.456],
  // [1688162415563, 30452.67121],
  // [1688166036098, 30470.35435],
  // [1688169638356, 30480.78148],
  // [1688173232824, 30478.34702],
  // [1688176844032, 30434.68825],
  // [1688180458208, 30418.05576],
  // [1688184043471, 30389.53698],
  // [1688187643450, 30391.78165],
  // [1688191233807, 30421.29259],
  // [1688194857428, 30407.305],
  // [1688198441833, 30440.2797],
  // [1688202043676, 30444.378],
  // [1688205666950, 30440.27146],
  // [1688209254740, 30470.09199],
  // [1688212818143, 30541.60154],
  // [1688216429068, 30601.15977],
  // [1688220038338, 30556.23903],
  // [1688223651437, 30599.37589],
  // [1688227207191, 30574.03674],
  // [1688230846703, 30569.29407],
  // [1688234442831, 30577.71705],
  // [1688238044511, 30592.57183],
  // [1688241629988, 30616.47222],
  // [1688245271492, 30591.503],
  // [1688248835846, 30591.50697],
  // [1688252460239, 30572.69746],
  // [1688256035097, 30583.6196],
  // [1688259656801, 30579.95271],
  // [1688263239171, 30555.89466],
  // [1688266870546, 30566.07971],
  // [1688270421572, 30505.93788],
  // [1688274091901, 30528.06555],
  // [1688277607893, 30513.30883],
  // [1688281239257, 30502.37491],
  // [1688284835614, 30508.8731],
  // [1688288450000, 30501.75108],
  // [1688292004412, 30534.18086],
  // [1688295642646, 30511.96562],
  // [1688299239596, 30538.90715],
  // [1688302838856, 30543.5302],
  // [1688306443023, 30511.22801],
  // [1688310025334, 30520.48222],
  // [1688313607847, 30474.92705],
  // [1688317217570, 30578.13791],
  // [1688320837312, 30496.09479],
  // [1688324435363, 30479.07545],
  // [1688328076211, 30555.50107],
  // [1688331690079, 30588.18238],
  // [1688335235228, 30576.2677],
  // [1688338867284, 30611.52681],
  // [1688342432754, 30571.88707],
  // [1688346041749, 30628.33494],
  // [1688349646909, 30673.47893],
  // [1688353201506, 30739.9227],
  // [1688356826265, 30772.61057],
  // [1688360455736, 30699.87029],
  // [1688364055280, 30672.3864],
  // [1688367683034, 30648.64744],
  // [1688371249325, 30663.39713],
  // [1688374820827, 30639.68745],
  // [1688378457263, 30624.67966],
  // [1688382040551, 30646.07744],
  // [1688385624732, 30642.54922],
  // [1688389276508, 30627.54413],
  // [1688392836513, 30639.12488],
  // [1688396428145, 30729.00555],
  // [1688400054545, 31049.87523],
  // [1688403663820, 31012.26771],
  // [1688407247432, 31038.68208],
  // [1688410884863, 31077.95512],
  // [1688414414635, 31276.64976],
  // [1688418060015, 31140.27671],
  // [1688421639050, 31065.89077],
  // [1688425226983, 31116.37681],
  // [1688428852634, 31134.71313],
  // [1688432401963, 31169.19431],
  // [1688436077814, 31246.6902],
  // [1688439647457, 31243.88705],
  // [1688443235032, 31220.78441],
  // [1688446821247, 31062.56784],
  // [1688450434841, 31021.20625],
  // [1688454021748, 31016.51896],
  // [1688457651106, 30922.49668],
  // [1688461245557, 30960.95534],
  // [1688464840431, 31009.41689],
  // [1688468455851, 31049.35306],
  // [1688472050192, 31032.00792],
  // [1688475682780, 31049.8031],
  // [1688479241174, 31023.6679],
  // [1688482841798, 31003.97771],
  // [1688486441408, 30969.60528],
  // [1688490049788, 30911.3504],
  // [1688493641706, 30915.08721],
  // [1688497246208, 30926.03423],
  // [1688500873517, 30724.67902],
  // [1688504418105, 30759.07089],
  // [1688508045054, 30815.5034],
  // [1688511627027, 30792.20469],
  // [1688515283149, 30763.60033],
  // [1688518855052, 30767.64073],
  // [1688522442100, 30814.80759],
  // [1688526073070, 30832.93853],
  // [1688529675643, 30874.04929],
  // [1688533278246, 30833.29286],
  // [1688536847868, 30840.99296],
  // [1688540449319, 30805.37118],
  // [1688544034059, 30783.10078],
  // [1688547636245, 30764.2163],
  // [1688551247222, 30689.64875],
  // [1688554823836, 30521.37201],
  // [1688558406927, 30411.1414],
  // [1688562043186, 30350.78509],
  // [1688565637862, 30379.90898],
  // [1688569243560, 30429.066],
  // [1688572881690, 30335.43158],
  // [1688576439198, 30429.24304],
  // [1688580042318, 30520.67688],
  // [1688583640686, 30466.7453],
  // [1688587205739, 30503.77563],
  // [1688590821395, 30496.39434],
  // [1688594441907, 30486.15783],
  // [1688598043590, 30429.12622],
  // [1688601639939, 30484.79377],
  // [1688605228112, 30414.57826],
  // [1688608832862, 30482.66614],
  // [1688612455211, 30473.77507],
  // [1688616052104, 30510.53424],
  // [1688619640942, 30469.94224],
  // [1688623210265, 30580.49027],
  // [1688626900953, 30659.14213],
  // [1688630440622, 30791.13209],
  // [1688634041817, 31139.90072],
  // [1688637627365, 31128.58036],
  // [1688641283256, 31144.52828],
  // [1688644811511, 31105.53928],
  // [1688648446978, 30612.88793],
  // [1688652033177, 30462.95491],
  // [1688655621466, 30153.25654],
  // [1688659260941, 30429.7186],
  // [1688662835467, 30262.8665],
  // [1688666436951, 30263.6054],
  // [1688670075555, 30283.17393],
  // [1688673644044, 30288.80829],
  // [1688677238968, 30277.27532],
  // [1688680844295, 30224.11987],
  // [1688684473833, 30197.66722],
  // [1688688003183, 29990.05515],
  // [1688691663950, 29976.12877],
  // [1688695244752, 30120.66776],
  // [1688698807659, 30098.62103],
  // [1688702401508, 30124.03025],
  // [1688706029912, 30100.54559],
  // [1688709644156, 30234.89084],
  // [1688713235798, 30132.92753],
  // [1688716824856, 30091.60661],
  // [1688720413532, 30055.23072],
  // [1688721790000, 30105.50135],
];
type sizeprops = {
  width: number | string;
  height: number | string;
};
export function CryptoTable({ width, height }: sizeprops) {
  const chartRef = useRef<ChartJS>(null);
  const [day, setday] = useState(15);
  const [chartData, setChartData] = useState<ChartData<"bar">>({
    datasets: [],
  });

  useEffect(() => {
    const chart = chartRef.current;

    if (!chart) {
      return;
    }

    const chartData = {
      ...data,
      datasets: data.datasets.map((dataset) => ({
        ...dataset,
        borderColor: createGradient(chart.ctx, chart.chartArea),
      })),
    };

    setChartData(chartData);
  }, []);

  return (
    <div style={{ width: width, height: height }}>
      <Line
        data={{
          labels: btc_chart_data.map((coin) => {
            let date = new Date(coin[0]);
            let time =
              date.getHours() > 12
                ? `${date.getHours() - 12}:${date.getMinutes()} PM`
                : `${date.getHours()}:${date.getMinutes()} AM`;
            return day === 1 ? time : date.toLocaleDateString();
          }),

          datasets: [
            {
              data: btc_chart_data.map((coin) => coin[1]),
              label: `Price ( Past ${day} Days ) in ${"usd"}`,
              borderColor: "#009EFF",
              borderWidth: 1.1,
              tension: 0.1,
            },
          ],
        }}
        options={{
          elements: {
            point: {
              radius: 1,
              hitRadius: 5,
            },
          },
          scales: {
            x: {
              grid: {
                display: false,
              },
              ticks: {
                display: false,
                color: "rgba(0 0 0/.0)",
                backdropColor: "rgba(0 0 0/0)",
              },
              beginAtZero: false,
              border: {
                width: 0,
              },
            },
            y: {
              grid: {
                display: false,
              },
              ticks: {
                display: false,
              },
              border: {
                width: 0,
              },
            },
          },
          plugins: {
            legend: {
              display: false,
            },
            tooltip: {
              enabled: false,
            },
          },
          responsive: true,
          // maintainAspectRatio: false,
        }}
      />
    </div>
  );
}
